<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>想いマグ - OMOI-MAG AR</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
</head>

<body style="margin: 0; overflow: hidden;">

    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">
        
        <a-assets>
            <audio id="insert-sound" src="sounds/kacha.mp3" preload="auto"></audio>
            <audio id="music-a" src="music/side-a.mp3" preload="auto"></audio>
            <audio id="music-b" src="music/side-b.mp3" preload="auto"></audio>
        </a-assets>

        <a-marker type="image" url="markers/marker-a.patt" id="marker-a">
            <a-entity text="value: Side A Playing; color: #FF0000" position="0 0.5 0" align="center"></a-entity>
        </a-marker>

        <a-marker type="image" url="markers/marker-b.patt" id="marker-b">
            <a-entity text="value: Side B Playing; color: #0000FF" position="0 0.5 0" align="center"></a-entity>
        </a-marker>

        <a-entity camera></a-entity>
    </a-scene>

    <script>
        const isAndroid = /Android/i.test(navigator.userAgent);
        const markerA = document.querySelector('#marker-a');
        const markerB = document.querySelector('#marker-b');
        const soundKacha = document.querySelector('#insert-sound');
        const musicA = document.querySelector('#music-a');
        const musicB = document.querySelector('#music-b');

        let isPlaying = false;

        // --- A面認識時の処理 ---
        markerA.addEventListener('markerFound', () => {
            if (!isPlaying) {
                // Androidの場合のみ磁極チェック（将来の実装用プレースホルダー）
                if (isAndroid) {
                    console.log("Android detected: Checking Magnetometer...");
                    // ここに磁気センサーの判定ロジックを追加可能
                }
                
                playContent(musicA);
            }
        });

        // --- B面認識時の処理 ---
        markerB.addEventListener('markerFound', () => {
            if (!isPlaying) {
                playContent(musicB);
            }
        });

        function playContent(targetMusic) {
            isPlaying = true;
            // 「カチャッ」音を再生
            soundKacha.play();
            
            // 少し遅らせて音楽を開始（カチャッの余韻のため）
            setTimeout(() => {
                targetMusic.play();
                console.log("Music started. Even if you move the magnet, it keeps playing.");
            }, 500);
        }

        // iPhone対策：画面タップでオーディオを有効化する案内を出すのがベストです
        window.addEventListener('click', () => {
            // ブラウザの自動再生制限を解除するためのダミー再生
            musicA.load();
            musicB.load();
            soundKacha.load();
        });
    </script>
</body>
</html>
